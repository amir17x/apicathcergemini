                    f"âŒ <b>Ø®Ø·Ø§ Ø¯Ø± ÙØ±Ø§ÛŒÙ†Ø¯ Ø³Ø§Ø®Øª Ú†Ù†Ø¯ Ø­Ø³Ø§Ø¨</b>\n\n"
                    f"Ù¾ÛŒØ§Ù… Ø®Ø·Ø§: {str(e)}\n\n"
                    f"Ø¯Ø± Ø­Ø§Ù„ ØªÙ„Ø§Ø´ Ø¨Ø§ ÛŒÚ© Ø­Ø³Ø§Ø¨..."
                )
                # ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø®Øª ÛŒÚ© Ø­Ø³Ø§Ø¨
                self.process_account_creation(chat_id, user_id, proxy)
        else:
            # Ø§Ú¯Ø± ÙÙ‚Ø· ÛŒÚ© Ø­Ø³Ø§Ø¨ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø´Ø¯Ù‡ ÛŒØ§ Ù„ÛŒØ³Øª Ù¾Ø±ÙˆÚ©Ø³ÛŒ Ù†Ø¯Ø§Ø±ÛŒÙ…
            self.process_account_creation(chat_id, user_id, proxy)
    
    def process_account_creation(self, chat_id, user_id, proxy=None):
        """Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø³Ø§Ø®Øª Ø­Ø³Ø§Ø¨ Ùˆ Ø¯Ø±ÛŒØ§ÙØª Ú©Ù„ÛŒØ¯ API."""
        # ØªÙˆÙ„ÛŒØ¯ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØªØµØ§Ø¯ÙÛŒ Ø¨Ø±Ø§ÛŒ Ø­Ø³Ø§Ø¨
        user_info = generate_random_user_info()
        
        # Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… ÙˆØ¶Ø¹ÛŒØª Ø§ÙˆÙ„ÛŒÙ‡
        self.send_message(chat_id, "â³ <b>Ø¯Ø± Ø­Ø§Ù„ Ø³Ø§Ø®Øª Ø­Ø³Ø§Ø¨ Gmail...</b>")
        
        try:
            # Ù…Ø±Ø­Ù„Ù‡ Û±: Ø³Ø§Ø®Øª Ø­Ø³Ø§Ø¨ Ø¬ÛŒÙ…ÛŒÙ„
            logger.info(f"Starting Gmail account creation for user {user_id}")
            
            gmail_result = gmail_creator.create_gmail_account(
                first_name=user_info['first_name'],
                last_name=user_info['last_name'],
                username=user_info['username'],
                password=user_info['password'],
                birth_day=user_info['birth_day'],
                birth_month=user_info['birth_month'],
                birth_year=user_info['birth_year'],
                gender=user_info['gender'],
                proxy=proxy
            )
            
            # Ø¨Ø±Ø±Ø³ÛŒ Ù†ØªÛŒØ¬Ù‡ Ø³Ø§Ø®Øª Ø¬ÛŒÙ…ÛŒÙ„
            if not gmail_result['success']:
                self.send_message(
                    chat_id, 
                    f"âŒ <b>Ø®Ø·Ø§ Ø¯Ø± Ø³Ø§Ø®Øª Ø­Ø³Ø§Ø¨ Gmail</b>\n\n"
                    f"Ù¾ÛŒØ§Ù… Ø®Ø·Ø§: {gmail_result.get('error', 'Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ø´Ø®Øµ')}\n\n"
                    f"Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø§Ø² Ù¾Ø±ÙˆÚ©Ø³ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.",
                )
                # Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ
                self.show_main_menu(chat_id, user_id)
                return
            
            # Ø³Ø§Ø®Øª Ø¬ÛŒÙ…ÛŒÙ„ Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ² Ø¨ÙˆØ¯
            gmail = gmail_result['gmail']
            
            # Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù¾ÛŒØ§Ù… ÙˆØ¶Ø¹ÛŒØª
            self.send_message(
                chat_id,
                f"âœ… <b>Ø­Ø³Ø§Ø¨ Gmail Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯:</b>\n"
                f"ğŸ“§ {gmail}\n\n"
                f"â³ <b>Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ú©Ù„ÛŒØ¯ API Gemini...</b>"
            )
            
            # Ù…Ø±Ø­Ù„Ù‡ Û²: Ø¯Ø±ÛŒØ§ÙØª Ú©Ù„ÛŒØ¯ API
            logger.info(f"Starting API key generation for {gmail}")
            
            api_result = api_key_generator.generate_api_key(
                gmail=gmail,
                password=user_info['password'],
                proxy=proxy
            )
            
            # Ø¯Ø±ÛŒØ§ÙØª ØªØ§Ø±ÛŒØ® Ùˆ Ø²Ù…Ø§Ù† ÙØ¹Ù„ÛŒ
            current_time = datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")
            
            # Ø§ÛŒØ¬Ø§Ø¯ Ù„ÛŒØ³Øª Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§ Ø§Ú¯Ø± Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª
            if 'accounts' not in self.user_data[user_id]:
                self.user_data[user_id]['accounts'] = []
            
            # Ø¨Ø±Ø±Ø³ÛŒ Ù†ØªÛŒØ¬Ù‡ Ø¯Ø±ÛŒØ§ÙØª Ú©Ù„ÛŒØ¯ API
            if not api_result['success']:
                # Ø¯Ø±ÛŒØ§ÙØª Ú©Ù„ÛŒØ¯ API Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯ Ø§Ù…Ø§ Ø­Ø³Ø§Ø¨ Ø¬ÛŒÙ…ÛŒÙ„ Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯
                partial_success_message = (
                    f"âš ï¸ <b>Ø­Ø³Ø§Ø¨ Gmail Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯ Ø§Ù…Ø§ Ø¯Ø±ÛŒØ§ÙØª API Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯</b> âš ï¸\n\n"
                    f"âœ… <b>Ø­Ø³Ø§Ø¨ Gmail:</b>\n<code>{gmail}</code>\n\n"
                    f"ğŸ”’ <b>Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±:</b>\n<code>{user_info['password']}</code>\n\n"
                    f"âŒ <b>Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ú©Ù„ÛŒØ¯ API:</b>\n"
                    f"{api_result.get('error', 'Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ø´Ø®Øµ')}\n\n"
                    f"âœ¨ <b>Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø­Ø³Ø§Ø¨:</b>\n"
                    f"ğŸ‘¤ Ù†Ø§Ù…: {user_info['first_name']} {user_info['last_name']}\n"
                    f"ğŸ“… ØªØ§Ø±ÛŒØ® ØªÙˆÙ„Ø¯: {user_info['birth_day']}/{user_info['birth_month']}/{user_info['birth_year']}\n"
                    f"â±ï¸ ØªØ§Ø±ÛŒØ® Ø§ÛŒØ¬Ø§Ø¯: {current_time}\n\n"
                    f"ğŸ”„ <b>Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø³ØªÛŒ Ú©Ù„ÛŒØ¯ API:</b>\n"
                    f"1ï¸âƒ£ Ø¨Ø§ Ø­Ø³Ø§Ø¨ Gmail Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ ÙˆØ§Ø±Ø¯ Ø³Ø§ÛŒØª https://aistudio.google.com Ø´ÙˆÛŒØ¯\n"
                    f"2ï¸âƒ£ Ø¨Ù‡ Ø¨Ø®Ø´ API Key Ø¯Ø± Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø®ÙˆØ¯ Ø¨Ø±ÙˆÛŒØ¯\n"
                    f"3ï¸âƒ£ Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ 'Create API Key' Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯\n"
                    f"4ï¸âƒ£ Ú©Ù„ÛŒØ¯ Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ Ø±Ø§ Ú©Ù¾ÛŒ Ú©Ù†ÛŒØ¯\n\n"
                    f"âš ï¸ <b>ØªÙˆØ¬Ù‡:</b> Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø­Ø³Ø§Ø¨ Gmail Ø±Ø§ Ø¯Ø± Ø¬Ø§ÛŒÛŒ Ø§Ù…Ù† Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯."
                )
                self.send_message(chat_id, partial_success_message)
                
                # Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø­Ø³Ø§Ø¨ Ø¨Ø¯ÙˆÙ† Ú©Ù„ÛŒØ¯ API Ø¯Ø± Ú©Ø´
                self.user_data[user_id]['accounts'].append({
                    'gmail': gmail,
                    'password': user_info['password'],
                    'api_key': None,
                    'status': 'api_failed',
                    'created_at': current_time
                })
                
                # Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø§Ú¯Ø± ÙØ¹Ø§Ù„ Ø§Ø³Øª
                if self.use_db:
                    try:
                        from flask import current_app
                        with current_app.app_context():
                            # ÛŒØ§ÙØªÙ† ÛŒØ§ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø±
                            user_db = self.User.query.filter_by(telegram_id=str(user_id)).first()
