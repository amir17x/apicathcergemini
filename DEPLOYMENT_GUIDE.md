# ๐ ุฑุงูููุง ุงุณุชูุฑุงุฑ ุจุฑูุงูู ุฏุฑ Railway

ุงู ุฑุงูููุง ุจู ุดูุง ฺฉูฺฉ ูโฺฉูุฏ ุชุง ุจุฑูุงูู ุฑุจุงุช ุชูฺฏุฑุงู ุฎูุฏ ุฑุง ุจู ุฏุฑุณุช ุฏุฑ Railway ุงุณุชูุฑุงุฑ ุฏูุฏ ู ูุดฺฉูโูุง ุงุญุชูุงู ุฑุง ุจุฑุทุฑู ฺฉูุฏ.

## ๐ ูุฑุงุญู ุงุณุชูุฑุงุฑ (ฺฏุงู ุจู ฺฏุงู)

1. ฺฉ ุญุณุงุจ ฺฉุงุฑุจุฑ ุฏุฑ [Railway](https://railway.app/) ุงุฌุงุฏ ฺฉูุฏ (ุงฺฏุฑ ูุฏุงุฑุฏ)
2. ูุฎุฒู ฺฏุชโูุงุจ ุฎูุฏ ุฑุง ุจู Railway ูุชุตู ฺฉูุฏ ุง ูุณุชููุงู ุจุง CLI ุขูพููุฏ ููุงุฏ
3. ฺฉ ุณุฑูุณ ุฏุชุงุจุณ PostgreSQL ุฏุฑ Railway ุงุฌุงุฏ ฺฉูุฏ:
   - ุฏุฑ ุฏุงุดุจูุฑุฏ Railwayุ ุฑู "New Service" ฺฉูฺฉ ฺฉูุฏ
   - ฺฏุฒูู "Database" ู ุณูพุณ "PostgreSQL" ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ
   - ููุชุธุฑ ุจูุงูุฏ ุชุง ุฏุชุงุจุณ ุงุฌุงุฏ ุดูุฏ
4. ูุชุบุฑูุง ูุญุท ุฒุฑ ุฑุง ุชูุธู ฺฉูุฏ:
   - `TELEGRAM_BOT_TOKEN`: ุชูฺฉู ุฑุจุงุช ุชูฺฏุฑุงู ุดูุง
   - `DATABASE_URL`: ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ุชูุธู ูโุดูุฏ (ุงฺฏุฑ ุงุฒ ุฏุชุงุจุณ Railway ุงุณุชูุงุฏู ูโฺฉูุฏ)
   - ุณุงุฑ ูุชุบุฑูุง ูุญุท ููุฑุฏ ูุงุฒ ูุงููุฏ ฺฉูุฏูุง TWILIO ุงฺฏุฑ ุงุฒ ุขู ุงุณุชูุงุฏู ูโฺฉูุฏ
5. ุฑูุด ุงุณุชูุฑุงุฑ ุฑุง ุจุฑ ุงุณุงุณ Dockerfile ุชูุธู ฺฉูุฏ:
   - ุฏุฑ ุชูุธูุงุช ุณุฑูุณุ ุจู ุจุฎุด Settings ุจุฑูุฏ
   - ุฏุฑ ูุณูุช Deployุ ุงุทููุงู ุญุงุตู ฺฉูุฏ ฺฉู "Dockerfile" ุงูุชุฎุงุจ ุดุฏู ุจุงุดุฏ
6. ุงุณุชูุฑุงุฑ ุฑุง ุขุบุงุฒ ฺฉูุฏ ุจุง ฺฉูฺฉ ุฑู "Deploy"
7. ูุงฺฏโูุง ุฑุง ุจุฑุง ุงุทููุงู ุงุฒ ุงุฌุฑุง ุฏุฑุณุช ุจุฑุฑุณ ููุงุฏ
8. ุขุฏุฑุณ ููุง ุจุฑูุงูู ุดูุง ุฏุฑ ุจุฎุด "Deployments" ูุงุจู ูุดุงูุฏู ุฎูุงูุฏ ุจูุฏ

## โ๏ธ ูุดฺฉูุงุช ุฑุงุฌ ู ุฑุงูโุญูโูุง

### ูุดฺฉู ฑ: ModuleNotFoundError: No module named 'distutils'

ุฏุฑ Python 3.12 ฺฉู ุฏุฑ Railway ุงุณุชูุงุฏู ูโุดูุฏุ ูุงฺูู `distutils` ุญุฐู ุดุฏู ุงุณุช. ฺฉุชุงุจุฎุงูู `undetected-chromedriver` ุจู ุงู ูุงฺูู ูุงุจุณุชู ุงุณุช.

## ุฑุงูโุญูโูุง

ุจุฑุง ุฑูุน ุงู ูุดฺฉูุ ฺูุฏู ุฑุงูโุญู ุฏุฑ ุงุฎุชุงุฑ ุดูุง ูุฑุงุฑ ุฏุงุฏู ุดุฏู ุงุณุช. ูโุชูุงูุฏ ฺฉ ุงุฒ ุงู ุฑูุดโูุง ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ:

### ุฑูุด ฑ: ุงุณุชูุงุฏู ุงุฒ Dockerfile (ุชูุตู ุดุฏู)

ูุงู `Dockerfile` ฺฉู ุฏุฑ ูุฎุฒู ุงุฑุงุฆู ุดุฏูุ ฺฉ ูุญุท ูพุงุฏุงุฑ ุจุง Python 3.10 ู ุชูุงู ูุงุจุณุชฺฏโูุง ููุฑุฏ ูุงุฒ ุงุฌุงุฏ ูโฺฉูุฏ. ฺฉุงู ุงุณุช ุงุทููุงู ุญุงุตู ฺฉูุฏ ฺฉู Railway ุจุฑุง ุงุณุชูุฑุงุฑ ุงุฒ Dockerfile ุงุณุชูุงุฏู ูโฺฉูุฏ.

1. ุฏุฑ ุชูุธูุงุช ูพุฑูฺู Railwayุ ุจู ุจุฎุด Settings ุจุฑูุฏ
2. ุฏุฑ ูุณูุช Deployุ ุญุงูุช ุฑุง ุจู "Nixpacks" ุง "Docker" ุชุบุฑ ุฏูุฏ
3. ูุงู `Dockerfile` ุจุงุฏ ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ุดูุงุณุง ู ุงุณุชูุงุฏู ุดูุฏ

### ุฑูุด ฒ: ุงุณุชูุงุฏู ุงุฒ ุชูุธูุงุช Railway

ูุงู `railway.toml` ุชูุธูุงุช ูุงุฒู ุจุฑุง ูุตุจ ูุงุจุณุชฺฏโูุง ุณุณุชู ู ุงุณุชูุงุฏู ุงุฒ Python 3.10 ุฑุง ูุฑุงูู ูโฺฉูุฏ.

### ุฑูุด ณ: ุงุณุชูุงุฏู ุงุฒ Procfile ู ุงุณฺฉุฑูพุช ุชุนูุฑ

ูุงู `Procfile` ู ุงุณฺฉุฑูพุช `fix-distutils.py` ุจู ุทูุฑ ุฎูุฏฺฉุงุฑ ูุดฺฉู ุฑุง ูุจู ุงุฒ ุงุฌุฑุง ุงุตู ุจุฑูุงูู ุจุฑุทุฑู ูโฺฉููุฏ.

### ุฑูุด ด: ุชุบุฑ ุฏุณุช ูุงู patcher.py

ูโุชูุงูุฏ ูุงู `patcher.py` ุฑุง ูุณุชููุงู ุฏุฑ ูุญุท Railway ุจุนุฏ ุงุฒ ุงุณุชูุฑุงุฑ ุชุบุฑ ุฏูุฏ:

1. ุจู ุชุฑููุงู SSH ุฏุฑ Railway ูุตู ุดูุฏ
2. ูุณุฑ ฺฉุชุงุจุฎุงูู ุฑุง ูพุฏุง ฺฉูุฏ:
   ```bash
   find /opt -name patcher.py | grep undetected_chromedriver
   ```
3. ูุงู ุฑุง ูุฑุงุด ฺฉูุฏ:
   ```bash
   nano [ูุณุฑ_ูุงู_ูพุฏุง_ุดุฏู]
   ```
4. ุฎุท `from distutils.version import LooseVersion` ุฑุง ุจู `from packaging.version import parse as LooseVersion` ุชุบุฑ ุฏูุฏ
5. ุงุจุชุฏุง ูุทูุฆู ุดูุฏ ฺฉู `pip install packaging` ุฑุง ุงุฌุฑุง ฺฉุฑุฏูโุงุฏ

## ูฺฉุงุช ููู

1. **ูุชุบุฑูุง ูุญุท**: ูุทูุฆู ุดูุฏ ฺฉู ุชูุงู ูุชุบุฑูุง ูุญุท ูุงุฒู (TELEGRAM_BOT_TOKENุ TWILIO_ACCOUNT_SID ู ุบุฑู) ุฏุฑ ุชูุธูุงุช Railway ูุงุฑุฏ ุดุฏูโุงูุฏ.

2. **ูพูุฑุช**: Railway ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ฺฉ ูพูุฑุช ุฑุง ุงุฒ ุทุฑู ูุชุบุฑ ูุญุท `PORT` ุงุฎุชุตุงุต ูโุฏูุฏ. ุฏุฑ Dockerfile ู Procfileุ ุงุฒ `${PORT:-5000}` ุงุณุชูุงุฏู ุดุฏู ุชุง ุฏุฑ ุตูุฑุช ุนุฏู ุชุนุฑู ูุชุบุฑุ ุงุฒ ูพูุฑุช 5000 ุงุณุชูุงุฏู ุดูุฏ. ุงฺฏุฑ ุจุง ุฎุทุง `'$PORT' is not a valid port number` ููุงุฌู ุดุฏุฏุ ุญุชูุงู ุงุฒ ุงู ุฑูุด ุงุณุชูุงุฏู ฺฉูุฏ.

3. **ุฏุชุงุจุณ**: ุงฺฏุฑ ุงุฒ ูพุงฺฏุงู ุฏุงุฏู PostgreSQL ุงุณุชูุงุฏู ูโฺฉูุฏุ ูุทูุฆู ุดูุฏ ฺฉู ฺฉ ุฎุฏูุช ุฏุชุงุจุณ ุฏุฑ Railway ุชูุธู ฺฉุฑุฏูโุงุฏ ู ูุชุบุฑ ูุญุท `DATABASE_URL` ุจู ุฏุฑุณุช ุชูุธู ุดุฏู ุงุณุช.

4. **ุจุงุฒุจู ูุงฺฏโูุง**: ุจุนุฏ ุงุฒ ุงุณุชูุฑุงุฑุ ูุงฺฏโูุง ุฑุง ุจุฑุฑุณ ฺฉูุฏ ุชุง ุงุฒ ุงุฌุฑุง ุตุญุญ ุจุฑูุงูู ูุทูุฆู ุดูุฏ.

## ุนุจโุงุจ

ุงฺฏุฑ ููฺูุงู ุจุง ูุดฺฉู ููุงุฌู ูุณุชุฏ:

1. **ุฎุทุง PORT**: ุงฺฏุฑ ุจุง ุฎุทุง `'$PORT' is not a valid port number` ููุงุฌู ูโุดูุฏุ ูุฑุงุญู ุฒุฑ ุฑุง ุงูุฌุงู ุฏูุฏ:
   - ุฏุฑ `Dockerfile` ู `Procfile` ุงุฒ ุนุจุงุฑุช `${PORT:-5000}` ุจู ุฌุง `$PORT` ุงุณุชูุงุฏู ฺฉูุฏ
   - ุฏุฑ ุชูุธูุงุช ูพุฑูฺู Railway ูุชุบุฑ ูุญุท `PORT` ุฑุง ุจู ุตูุฑุช ุฏุณุช ุจุง ููุฏุงุฑ ุนุฏุฏ (ูุซูุงู ตฐฐฐ) ุชูุธู ฺฉูุฏ
   - ุฏุฑ ูุงู `railway.toml` ุฏุฑ ุจุฎุด `[variables]` ููุฏุงุฑ `PORT = "5000"` ุฑุง ุงุถุงูู ฺฉูุฏ
   - ุจุฑุง ูุฑ ูุชุบุฑ ูุญุท ุฏุฑ `${VAR}` ุงุทููุงู ุญุงุตู ฺฉูุฏ ฺฉู ฺฉ ููุฏุงุฑ ูพุดโูุฑุถ ูุงููุฏ `${VAR:-default}` ุฏุฑ ูุธุฑ ฺฏุฑูุชู ุดุฏู

2. **ูุดฺฉู healthcheck**: ุงฺฏุฑ ุจุง ุฎุทุง "Service unavailable" ุฏุฑ healthcheck ููุงุฌู ูโุดูุฏ:
   - ุณุงุฏูโุชุฑู ุฑุงูโุญู: ูุณุฑ healthcheck ุฑุง ุฏุฑ ูุงู `railway.toml` ุจู `/healthz` ุชุบุฑ ุฏูุฏ ู ูุทูุฆู ุดูุฏ ฺฉู ุงูุฏูพููุช ูุฑุจูุทู ุฏุฑ `main.py` ูพุงุณุฎ ุณุงุฏูโุง ูุซู `"OK"` ุจุฑูโฺฏุฑุฏุงูุฏ
   - ุงฺฏุฑ ุจุง ุฎุทุง persistent ููุงุฌู ูุณุชุฏุ ฺูุฏู ูุณุฑ healthcheck ุฑุง ุงูุชุญุงู ฺฉูุฏ: `/healthz`ุ `/health` ู `/_health`
   - `healthcheckTimeout` ุฑุง ุจู ณฐ ุซุงูู ู `healthcheckInterval` ุฑุง ุจู ณฐ ุซุงูู ุชุบุฑ ุฏูุฏ
   - ุฏุฑ ูุงู `railway.toml` ฺูุฏู ูุณุฑ healthcheck ุจู ุตูุฑุช ุฒุฑ ุชุนุฑู ฺฉูุฏ:
     ```toml
     [[healthchecks]]
     path = "/healthz"
     timeout = 30
     interval = 15
     grace = 120
     
     [[healthchecks]]
     path = "/health"
     timeout = 30
     interval = 15
     ```
   - ุงุทููุงู ุญุงุตู ฺฉูุฏ ฺฉู ูุณุฑูุง healthcheck ุจู ุฏุฑุณุช ุฏุฑ `main.py` ูพุงุฏูโุณุงุฒ ุดุฏูโุงูุฏ ู ูพุงุณุฎ ุจุณุงุฑ ุณุงุฏูโุง ูโุฏููุฏ
   - ุงฺฏุฑ ุจุงุฒ ูู ูุดฺฉู ุงุฏุงูู ุฏุงุดุชุ ุณุน ฺฉูุฏ `workers` ุฑุง ุฏุฑ Gunicorn ุจู ฑ ฺฉุงูุด ุฏูุฏ ุชุง ุจุงุฑ ฺฉุงุฑ ุณุฑูุฑ ฺฉูุชุฑ ุดูุฏ

3. **ุงุณุชูุงุฏู ุงุฒ ูุณุฎู ุฎุงุต ฺฉุชุงุจุฎุงูู**: ูโุชูุงูุฏ ุจู ุตูุฑุช ุฏุณุช ูุณุฎู ุฎุงุต ุงุฒ undetected-chromedriver ุฑุง ูุตุจ ฺฉูุฏ ฺฉู ุจุง Python 3.12 ุณุงุฒฺฏุงุฑ ุงุณุช.

4. **ุบุฑูุนุงู ฺฉุฑุฏู ูููุช**: ุจุฑุง ุชุณุชุ ูโุชูุงูุฏ ุจุง ุชุบุฑ ูููุช ฺฉุฏุ ุจุฎุดโูุง ูุฑุจูุท ุจู ุฌููโฺฉุฑุชูุฑ ู ุงุชููุงุณูู ูุจ ุฑุง ุบุฑูุนุงู ฺฉูุฏ ุชุง ุญุฏุงูู ุฑุจุงุช ุชูฺฏุฑุงู ฺฉุงุฑ ฺฉูุฏ.

5. **ูพุดุชุจุงู Railway**: ูโุชูุงูุฏ ุงุฒ ุชู ูพุดุชุจุงู Railway ุฏุฑุฎูุงุณุช ฺฉูฺฉ ฺฉูุฏ ุง ุจู ุงูุฌูู ุขูโูุง ูุฑุงุฌุนู ฺฉูุฏ.

ุงูุฏูุงุฑู ฺฉ ุงุฒ ุงู ุฑุงูโุญูโูุง ูุดฺฉู ุดูุง ุฑุง ุจุฑุทุฑู ฺฉูุฏ!

## ๐ ุฑูุน ุฎุทุง "Service Unavailable" ุฏุฑ ููฺฏุงู ุงุณุชูุฑุงุฑ

ุงฺฏุฑ ุจุง ุฎุทุง `Healthcheck Retry window: 2m0s` ู `Attempt # failed with service unavailable` ููุงุฌู ูโุดูุฏุ ุงู ุฎุทุง ูุดุงู ูโุฏูุฏ ฺฉู Railway ููโุชูุงูุฏ ุจู ูุณุฑ ุณูุงูุชโุณูุฌ ุจุฑูุงูู ุฏุณุชุฑุณ ูพุฏุง ฺฉูุฏ. ุจุฑุง ุฑูุน ุงู ูุดฺฉู ููุงุฑุฏ ุฒุฑ ุฑุง ุงูุฌุงู ุฏูุฏ:

### ุฑุงูโุญู ููุฑ:

1. **ุณุงุฏูโุณุงุฒ ุงูุฏูพููุช healthcheck**:
   ```python
   @app.route('/healthz')
   def healthz():
       return "OK", 200
   ```
   
2. **ุงุถุงูู ฺฉุฑุฏู ฺูุฏู ูุณุฑ healthcheck**:
   ```python
   @app.route('/health')
   def health():
       return "OK", 200
       
   @app.route('/_health')
   def _health():
       return "OK", 200
   ```

3. **ุชูุธู ุตุญุญ ูุงู railway.toml**:
   ```toml
   [deploy]
   healthcheckPath = "/healthz"
   healthcheckTimeout = 30
   healthcheckInterval = 30
   
   [[healthchecks]]
   path = "/healthz"
   timeout = 30
   interval = 15
   grace = 120
   ```

4. **ุชูุธู Gunicorn ุจุฑุง ูพุงุณุฎฺฏู ุณุฑุน**:
   ```
   web: gunicorn --bind 0.0.0.0:${PORT:-5000} --workers 1 --threads 2 --timeout 90 --keep-alive 5 main:app
   ```

5. **ูุนุงู ฺฉุฑุฏู ูุงฺฏโูุง ุจุฑุง ุนุจโุงุจ**:
   ```
   --access-logfile - --error-logfile -
   ```

ุจุง ุงุนูุงู ุงู ุชุบุฑุงุชุ ูุดฺฉู "Service Unavailable" ุจุงุฏ ุจุฑุทุฑู ุดูุฏ ู ุงุณุชูุฑุงุฑ ุจุง ููููุช ุงูุฌุงู ุดูุฏ.